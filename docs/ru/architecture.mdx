---
weight: 30
sourceSHA: cd4932e498bacc77e95637022b8691bed837581c388d1790c12abbcb3f9447a8
---

# Архитектура

Справочный документ: [Официальная документация Zalando Postgres Operator](https://opensource.zalando.com/postgres-operator/docs/)
![Архитектура PostgreSQL Operator](../zh/assets/operator.png)

PostgreSQL Operator управляет кластерами PostgreSQL, используя паттерн Kubernetes Operator, в основном состоящий из следующих основных компонентов:

## Основные компоненты

1. **Контроллер оператора**
   - Прослушивает изменения в определениях пользовательских ресурсов PostgreSQL (CRD)
   - Ответственен за создание кластеров, масштабирование, обновления конфигурации и другие операции
   - Управляет жизненным циклом кластера

2. **Patroni**
   - Обеспечивает гарантии высокой доступности
   - Обрабатывает переключение между основным и резервным узлами и переключение при сбоях
   - Управляет топологией кластера и статусом членов

3. **Spilo**
   - Обеспечивает образ контейнера PostgreSQL
   - Интегрирует Patroni и PostgreSQL
   - Обрабатывает конфигурацию и начальную настройку

4. **Компонент мониторинга**
   - Интегрирует Prometheus для сбора метрик
   - Обеспечивает панели Grafana
   - Поддерживает конфигурацию правил оповещения

## Поток данных

1. Пользователи создают пользовательский ресурс PostgreSQL через API Kubernetes
2. Контроллер оператора прослушивает изменения ресурсов и создает соответствующие ресурсы Kubernetes
3. Patroni отвечает за инициализацию и управление высокой доступностью кластера
4. Spilo запускает экземпляр PostgreSQL и применяет конфигурацию
5. Компонент мониторинга собирает метрики и отображает их

## Режимы

PostgreSQL Operator поддерживает следующие режимы развертывания:

- **Режим единого кластера**: Работает в одном кластере Kubernetes
- **Режим мультикластера**: Управляет экземплярами PostgreSQL в нескольких кластерах Kubernetes
- **Режим высокой доступности**: Обеспечивает автоматическое переключение при сбоях с помощью Patroni
